<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="bower_components/iron-icon/iron-icon.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="bower_components/paper-menu/paper-menu.html">
<link rel="import" href="bower_components/paper-item/paper-item.html">
<link rel="import" href="bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="bower_components/neon-animation/animations/fade-out-animation.html">

<dom-module id="micro-panel">
	<template strip-whitespace>
		<style>
			:host {
				--paper-toolbar-content: { padding: 0; };
			}
			.content-wrapper { overflow: hidden; height: 100%; height: calc(100vh - 64px); }
			neon-animatable, neon-animatable > * { width: 100%; height: 100%; border: 0; background: #fff; }
			paper-icon-button { margin-right: 0 !important; }
			paper-tabs { flex: 1 1 auto; height: 64px; }

			@media screen and (min-width: 450px) {
				#open-url-input { min-width: 70vw; }
			}

			@media screen and (max-width: 600px) {
				.content-wrapper { height: calc(100vh - 56px); }
				paper-tabs { height: 56px; }
			}
		</style>

		<paper-header-panel>
			<paper-toolbar>
				<paper-menu-button id="menu-button" open-animation-config='[{"name": "fade-in-animation", "timing": {"duration": 200}}]'
						close-animation-config='[{"name": "fade-out-animation", "timing": {"duration": 200}}]'>
					<paper-icon-button icon="menu" class="dropdown-trigger"></paper-icon-button>
					<paper-menu class="dropdown-content">
						<paper-icon-item><iron-icon icon="create" item-icon></iron-icon>New post</paper-icon-item>
						<paper-icon-item on-tap="showOpenUrl"><iron-icon icon="input" item-icon></iron-icon>Open URL</paper-icon-item>
						<paper-icon-item on-tap="showAbout"><iron-icon icon="info" item-icon></iron-icon>About...</paper-icon-item>
					</paper-menu>
				</paper-menu-button>
				<paper-tabs id="tabs" scrollable hide-scroll-buttons selected="{{selected}}">
					<paper-tab>Website</paper-tab>
					<paper-tab>Drafts</paper-tab>
				</paper-tabs>
			</paper-toolbar>

			<neon-animated-pages entry-animation="fade-in-animation" exit-animation="fade-out-animation"
					selected="[[selected]]" class="content-wrapper content fit">
				<neon-animatable>
					<iframe id="frame" src="[[src]]"></iframe>
				</neon-animatable>
				<neon-animatable>
					TODO
				</neon-animatable>
			</neon-animated-pages>
		</paper-header-panel>

		<paper-dialog id="open-url-dialog" on-iron-overlay-closed="openUrlClosed"
				modal entry-animation="fade-in-animation" exit-animation="fade-out-animation">
			<h2>Open URL</h2>
			<paper-input id="open-url-input" label="URL" type="url"></paper-input>
			<div class="buttons">
				<paper-button dialog-dismiss>Cancel</paper-button>
				<paper-button dialog-confirm>Go</paper-button>
			</div>
		</paper-dialog>

		<paper-dialog id="about-dialog" modal entry-animation="fade-in-animation" exit-animation="fade-out-animation">
			<h2>About</h2>
			<p>
				micro-panel is an admin panel for websites that support <a href="http://micropub.net/draft/">micropub</a> and <a href="http://microformats.org/wiki/microformats2">microformats2</a>.
			</p>
			<div class="buttons">
				<paper-button dialog-dismiss>Close</paper-button>
			</div>
		</paper-dialog>

	</template>

	<script>'use strict'
		Polymer({
			is: 'micro-panel',

			properties: {
				selected: { type: Number, value: 0 },
				src: { type: String, value: "/" }
			},

			attached: function () {
				this.$.frame.addEventListener('load', function (e) {
					console.log(e)
				})
			},

			showOpenUrl: function () {
				this.$['menu-button'].close()
				this.$['open-url-input'].value = this.$.frame.contentWindow.location.href
				this.$['open-url-dialog'].open()
			},
			openUrlClosed: function (e) {
				if (!e.detail.confirmed) return
				this.src = this.$['open-url-input'].value
			},

			showAbout: function () {
				this.$['menu-button'].close()
				this.$['about-dialog'].open()
			}

		})
	</script>
</dom-module>
